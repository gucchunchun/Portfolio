---
import { actions, isInputError } from "astro:actions";
import { navigate } from 'astro:transitions/client';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Input from "../ui/form/Input.astro";
import Textarea from "../ui/form/Textarea.astro";
import Disclaimer from "../ui/form/Disclaimer.astro";
import SubmitButton from "../ui/form/SubmitButton.astro";
import type { Contact as Props } from '~/types';

const {
  label = {
    name: "",
    email: "",
    message: "",
    disclaimer: "",
  },

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;

// Read form result
const result = Astro.getActionResult(actions.sendEmail);
const inputErrors = isInputError(result?.error) ? result.error.fields : {};
console.log("result", result)

if (!result?.error) {
  window.alert("success");
  navigate("/")
}

// Detect success from query param
const isSuccess = !result?.error
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div class="flex justify-center">
    <form action={actions.sendEmail} method="post" class="max-w-5xl">
      <Input 
        type="text"
        name="name"
        label={label.name}
        required
        errors={inputErrors.name}
      />
      <Input 
        type="email"
        name="email"
        label={label.email}
        required
        errors={inputErrors.email}
      />
      <Textarea 
        name="message"
        label={label.message}
        errors={inputErrors.message}
      />
      <Disclaimer 
        name="disclaimer"
        required
        errors={inputErrors.disclaimer}
        label={label.disclaimer}
      />
      <SubmitButton
        label="Send"
      />  
    </form>
  </div>
</WidgetWrapper>
{isSuccess && <script>
  alert("Email Sent Successfully!");
  window.history.replaceState({}, document.title, window.location.pathname);
</script>}
